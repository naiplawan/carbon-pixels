/* Font CSS import moved to layout.tsx for better loading performance */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Import mobile-specific optimizations */
@import '../styles/mobile.css';

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --paper: 48 20% 97%;
    --ink: 222.2 47% 11%;
    --pencil: 217.2 32.6% 17.5%;
    
    /* Safe area insets for mobile devices */
    --safe-area-top: env(safe-area-inset-top, 0px);
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-left: env(safe-area-inset-left, 0px);
    --safe-area-right: env(safe-area-inset-right, 0px);
    
    /* Touch target minimum sizes */
    --touch-target-min: 44px;
    --touch-target-recommended: 48px;
    --touch-target-comfortable: 56px;
    
    /* Mobile viewport adjustments */
    --mobile-padding: max(1rem, var(--safe-area-left));
    --mobile-margin: 0.75rem;
  }

  * {
    @apply border-gray-300;
  }
  
  body {
    @apply bg-paper text-ink font-handwritten;
    background-image: 
      radial-gradient(circle at 1px 1px, rgba(45, 55, 72, 0.08) 1px, transparent 0);
    background-size: 20px 20px;
  }
}

@layer components {
  .notebook-page {
    @apply bg-paper border-l-4 border-red-300 pl-4 md:pl-8 min-h-screen;
    background-image: 
      linear-gradient(90deg, rgba(239, 68, 68, 0.2) 1px, transparent 1px),
      linear-gradient(rgba(156, 163, 175, 0.2) 1px, transparent 1px);
    background-size: 2rem 2rem, 100% 2rem;
    /* Safe area support */
    padding-left: max(1rem, var(--safe-area-left, 0px));
    padding-right: var(--safe-area-right, 0px);
  }

  .handwritten-text {
    @apply font-handwritten text-ink;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
  }

  .sketch-element {
    filter: 
      drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.1))
      drop-shadow(-1px -1px 1px rgba(255, 255, 255, 0.5));
    /* Hardware acceleration for better mobile performance */
    transform: translateZ(0);
    will-change: transform;
  }

  /* Touch-friendly button base class */
  .touch-button {
    @apply min-h-[44px] min-w-[44px] rounded-xl transition-all duration-200;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Enhanced touch button with larger comfortable size */
  .touch-button-comfortable {
    @apply min-h-[56px] min-w-[56px] rounded-2xl;
  }

  /* Mobile-optimized form controls */
  .mobile-input {
    @apply min-h-[48px] text-base border-2 rounded-xl px-4 py-3;
    font-size: 16px; /* Prevents zoom on iOS */
    touch-action: manipulation;
  }

  .mobile-select {
    @apply min-h-[48px] text-base border-2 rounded-xl px-4 py-3 pr-12;
    font-size: 16px;
    touch-action: manipulation;
    appearance: none;
    background-image: url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="%23374151"%3E%3Cpath fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/%3E%3C/svg%3E');
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px 16px;
  }

  /* Safe area utilities */
  .safe-top {
    padding-top: var(--safe-area-top, 0px);
  }
  
  .safe-bottom {
    padding-bottom: var(--safe-area-bottom, 0px);
  }
  
  .safe-left {
    padding-left: var(--safe-area-left, 0px);
  }
  
  .safe-right {
    padding-right: var(--safe-area-right, 0px);
  }

  .safe-area-full {
    padding-top: var(--safe-area-top, 0px);
    padding-bottom: var(--safe-area-bottom, 0px);
    padding-left: var(--safe-area-left, 0px);
    padding-right: var(--safe-area-right, 0px);
  }

  /* Edge-to-edge layouts */
  .edge-to-edge {
    margin-left: calc(-1 * var(--safe-area-left, 0px));
    margin-right: calc(-1 * var(--safe-area-right, 0px));
    padding-left: var(--safe-area-left, 0px);
    padding-right: var(--safe-area-right, 0px);
  }

  /* Mobile viewport fix */
  .mobile-viewport {
    min-height: 100vh;
    min-height: 100dvh; /* Dynamic viewport height for mobile */
  }

  /* Accessibility improvements */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .focus-visible {
    @apply outline-none ring-2 ring-offset-2 ring-green-500;
  }

  /* Button accessibility */
  button:focus-visible,
  a:focus-visible {
    @apply outline-none ring-2 ring-offset-2 ring-green-500 ring-opacity-75;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .notebook-page {
      background-image: none;
      @apply border-l-8 border-black;
    }
    
    .handwritten-text,
    .text-ink {
      @apply text-black;
    }
    
    .text-pencil {
      @apply text-gray-800;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-draw,
    .animate-fade-in {
      animation: none;
    }
    
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Mobile performance optimizations and touch targets */
  @media (max-width: 768px) {
    /* Reduce repaints on mobile */
    .notebook-page {
      background-attachment: scroll;
    }
    
    /* Optimize touch interactions */
    .sketch-element {
      transform: translateZ(0); /* Hardware acceleration */
      will-change: transform; /* Prepare for animations */
    }
    
    /* Reduce shadow complexity on mobile */
    .handwritten-text {
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
    }
    
    /* Optimize gradients for mobile GPUs */
    .bg-gradient-to-r {
      background-size: 200% 100%;
      background-position: 0% 0%;
    }
    
    /* Enhanced touch targets on mobile */
    button,
    a,
    input[type="button"],
    input[type="submit"],
    input[type="reset"] {
      min-height: var(--touch-target-min);
      min-width: var(--touch-target-min);
    }
    
    /* Comfortable touch spacing */
    .touch-area {
      padding: 0.75rem;
    }
    
    /* Prevent double-tap zoom on buttons */
    button,
    input,
    select,
    textarea {
      touch-action: manipulation;
    }
    
    /* Improve scrolling performance */
    * {
      -webkit-overflow-scrolling: touch;
    }
    
    /* Larger text for better readability */
    .text-sm {
      @apply text-base;
    }
    
    /* Increased line height for better touch targets in text */
    p, li, span {
      line-height: 1.6;
    }
    
    /* Mobile-first responsive spacing */
    .mobile-spacing {
      padding: var(--mobile-margin);
      margin: var(--mobile-margin) 0;
    }
    
    /* Enhanced focus indicators for accessibility */
    .focus-enhanced {
      outline: 3px solid #10B981;
      outline-offset: 2px;
    }
  }

  /* Performance hints for browsers */
  .modal-backdrop {
    contain: layout style paint;
    will-change: opacity;
  }
  
  .scanner-camera {
    contain: layout style paint size;
    transform: translateZ(0);
  }

  /* Dark mode support with performance considerations */
  @media (prefers-color-scheme: dark) {
    .notebook-page {
      @apply bg-gray-900 text-gray-100;
      background-image: 
        linear-gradient(90deg, rgba(239, 68, 68, 0.3) 1px, transparent 1px),
        linear-gradient(rgba(156, 163, 175, 0.3) 1px, transparent 1px);
    }
    
    .text-ink {
      @apply text-gray-100;
    }
    
    .text-pencil {
      @apply text-gray-300;
    }
    
    .bg-white\/70 {
      @apply bg-gray-800/70;
    }
  }

  /* Critical rendering path optimization */
  .above-fold {
    contain: layout style;
  }
  
  .below-fold {
    content-visibility: auto;
    contain-intrinsic-size: 300px;
  }
}